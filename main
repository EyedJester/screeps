var roleHarvester = require('role.harvester');
var roleUpgrader = require('role.upgrader');
var roleBuilder = require('role.newbuilder')
var roleDevotedUpgrader = require('role.devotedupgrader')
var roleTester = require('role.tester')
var roleRepairman = require('role.repairman')
var roleFootSoldier = require('role.footsoldier')
var roleEMcarrier = require('role.carrier')
var roleSupplier = require('role.supplier')
var findSources = require('var.findSources')
var findExtensions = require ('var.findExtensions')
var autoSpawn = require('fun.autoSpawn');

module.exports.loop = function () {
    try {
    for(var name in Memory.creeps) {
        if(!Game.creeps[name]) {
            delete Memory.creeps[name];
            console.log('Clearing non-existing creep memory:', name);
        }
    }
    
    var spawn = Game.spawns['Spawn1'];
    
    var harvesters = _.filter(Game.creeps, (creep) => creep.memory.role == 'harvester');
    
    var upgrader = _.filter(Game.creeps, (creep) => creep.memory.role == 'upgrader');
    
    var builder = _.filter(Game.creeps, (creep) => creep.memory.role == 'builder');
    
    var devotedUpgrader = _.filter(Game.creeps, (creep) => creep.memory.role == 'devotedUpgrader');
    
    var footSoldier = _.filter(Game.creeps, (creep) => creep.memory.role == 'footSoldier');
    
    var repairMan = _.filter(Game.creeps, (creep) => creep.memory.role == 'repairman');
    
    var emCarrier = _.filter(Game.creeps, (creep) => creep.memory.role == 'emCarrier');
    
    var supplier = _.filter(Game.creeps, (creep) => creep.memory.role == 'supplier');
    
    console.log('Harvesters: ' + harvesters.length + ', Builders: ' + builder.length + ', Devoted Upgraders: ' + devotedUpgrader.length + ', Foot soldiers: ' + footSoldier.length + ', Repair men: ' + repairMan.length + ', Emergency Carriers: ' + emCarrier.length + ', Suppliers: ' + supplier.length);
    
    try {
        
    //autoSpawn.run()
    ech
    }
    catch (err) {
    if(harvesters.length < 2) {
        var newName = Game.spawns['Spawn1'].createCreep([WORK, WORK, CARRY, MOVE], undefined, {role: 'harvester'});
        console.log('Spawning new harvester: ' + newName);
    }
    
    if(devotedUpgrader.length < 2 && harvesters.length == 2) {
        var newName = Game.spawns['Spawn1'].createCreep([WORK,CARRY,MOVE, MOVE], undefined, {role: 'devotedUpgrader'});
        console.log('Spawning new devoted upgrader: ' + newName);
    }
    
    if(builder.length < 2 && harvesters.length == 2) {
        var newName = Game.spawns['Spawn1'].createCreep([WORK,CARRY,CARRY,MOVE], undefined, {role: 'builder'});
        console.log('Spawning new builder: ' + newName);
    }
    
    if(repairMan.length < 2 && harvesters.length == 2 && builder.length == 2) {
        var newName = Game.spawns['Spawn1'].createCreep([WORK,CARRY,CARRY,MOVE,MOVE], undefined, {role: 'repairman'});
        console.log('Spawning new repairman: ' + newName);
    }
     
    if(footSoldier.length < 7 && harvesters.length == 2 && repairMan.length == 100) {
    Game.spawns['Spawn1'].createCreep([MOVE, ATTACK, TOUGH, CARRY, TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,TOUGH,], newName, {role: 'footSoldier'});
    }
    
    if(footSoldier.length < 11 && harvesters.length == 2 && harvesters.length == 1000) {
        Game.spawns['Spawn1'].createCreep([MOVE, MOVE, ATTACK, ATTACK, ATTACK, ATTACK, CARRY, CARRY, TOUGH, TOUGH, TOUGH], newName, {role: 'footSoldier'});
    }
    
    if (emCarrier.length < -1 && harvesters.length == 2) {
        Game.spawns['Spawn1'].createCreep([MOVE,MOVE,MOVE,CARRY,CARRY,CARRY], undefined, {role: 'emCarrier'});
    }
    console.log('I mean... You messed up somewhere. ' + err)
    }
    
    for(var name in Game.creeps) {
        var creep = Game.creeps[name];
        if(creep.memory.role == 'harvester') {
            roleHarvester.run(creep);
            //findSources.run(creep);
            //findExtensions.run(creep);
        }
        if(creep.memory.role == 'upgrader') {
            roleUpgrader.run(creep);
        }
        if(creep.memory.role == 'builder') {
            roleBuilder.run(creep);
        }
        if(creep.memory.role == 'devotedUpgrader') {
            roleDevotedUpgrader.run(creep);
        }
        
        if(creep.memory.role == 'repairman') {
            roleRepairman.run(creep);  
        }
        
        if(creep.memory.role == 'footSoldier') {
            roleFootSoldier.run(creep)
        }
        
        if(creep.memory.role == 'emCarrier') {
            roleEMcarrier.run(creep);
        }
        
        if(creep.memory.roll == 'supplier') {
            roleSupplier.run(creep);
        }
}
}
catch (err) {
    
    var insult = Math.floor((Math.random() * 7) + 1);
    var ouch = [
        "Let's see here.... I would say you went wrong right about... HERE! ",
        "Welp, let's spin the wheel of misfortune. ",
        'Your village will fall. ',
        'Everyone is actually dying. ',
        "You're screwed. ",
        "I actually feel bad for you. ",
        'If I were you, I would either run or fix this problem. If you feel like fixing it, ']
    console.log(ouch[insult] + err);
    
}
}
